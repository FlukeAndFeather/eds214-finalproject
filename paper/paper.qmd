---
title: "EDS 214 - Final Project"
format:
  html:
    output-file: "index.html"
---

# Background

This paper serves as documentation for the final project of *EDS 214: Analytical Workflows and Scientific Reproducibility*. The goal is to create a reproducible, analytical workflow and remake Figure 3 of Schaefer et al. (2000). Figure 3 displays five stream nutrients over time from 1988-1994, showing the long-term effects of Hurricane Hugo (1989) on Puerto Rican streams. In the methods section of Schaefer et al. (2000), it was also mentioned that a 9-week moving average was used when creating each time-series.

> Schaefer, Douglas. A., McDowell, W. H., Scatena, F. N., & Asbury, C. E. (2000). Effects of hurricane disturbance on stream water concentrations and fluxes in eight tropical forest watersheds of the Luquillo Experimental Forest, Puerto Rico. Journal of Tropical Ecology, 16(2), 189â€“207. <https://doi.org/10.1017/s0266467400001358>

## Figure 3:

![](https://zachyyy700.github.io/eds214-finalproject/Figure3.png)

# Data

Date was retrieved from the [EDI Data Portal](https://portal.edirepository.org/nis/mapbrowse?packageid=knb-lter-luq.20.4923064), the datasets utilized are as follows:

1.  Quebrada one-Bisley (Q1) Chemistry Data
2.  Quebrada two-Bisley (Q2) Chemistry Data
3.  Quebrada three-Bisley (Q3) Chemistry Data
4.  Puente Roto Mameyes (MPR) Chemistry Data

## Data Importing & Combining

Details on importing, combining, and cleaning data can be found in [`1_dataimport_cleaning.R`](https://github.com/zachyyy700/eds214-finalproject/blob/main/1_data_import_cleaning.R)

##### **Install necessary packages to replicate this Quarto doc by seeing [`0_environ_init.R`](https://github.com/zachyyy700/eds214-finalproject/blob/main/0_environ_init.R)**

```{r}
#| warning: false
#| message: false
# read cleaned data
library(tidyverse)
streams_long <- read_csv(here::here("outputs/streams_clean.csv"))
```

# Methods

Two functions were created to 1. calculate the 9-week moving average of irregular observation windows (see [`R/moving_avg_function.R`](https://github.com/zachyyy700/eds214-finalproject/blob/main/R/moving_avg_function.R)) and 2. apply the moving average function over a range of columns and create new rolling average columns for each stream measurement (see [`R/zapply.R`](https://github.com/zachyyy700/eds214-finalproject/blob/main/R/zapply.R) for function creation and [`1_data_import_cleaning.R`](https://github.com/zachyyy700/eds214-finalproject/blob/main/1_data_import_cleaning.R) for application use.

The end product being `streams_long`, a combined dataframe with all streams and their respective moving average measurements.

# Results

```{r}
#| echo: false
library(patchwork)

p1 <- ggplot(streams_long, aes(x = sample_date, color = sample_id)) +
  geom_line(aes(y = k_rolling)) +
  scale_color_brewer(palette = "Dark2") +
  labs(y = "K (mg/l)") +
  theme_classic() +
  geom_vline(xintercept = as.Date("1989-09-10"),
             linetype = "dotdash") +
  theme(axis.title.x = element_blank(),
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        legend.position = "none") 

p2 <- ggplot(streams_long, aes(x = sample_date, color = sample_id)) +
  geom_line(aes(y = no3_n_rolling)) +
  scale_color_brewer(palette = "Dark2") +
  labs(y = "NO3 (ug/l)") +
  theme_classic() +
  geom_vline(xintercept = as.Date("1989-09-10"),
             linetype = "dotdash") +
  theme(axis.title.x = element_blank(),
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        legend.position = "none")

p3 <- ggplot(streams_long, aes(x = sample_date, color = sample_id)) +
  geom_line(aes(y = mg_rolling)) +
  scale_color_brewer(palette = "Dark2") +
  labs(y = "Mg (mg/l)") +
  labs(color = "Stream ID") +
  theme_classic() +
  geom_vline(xintercept = as.Date("1989-09-10"),
             linetype = "dotdash") +
  theme(axis.title.x = element_blank(),
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank())

p4 <- ggplot(streams_long, aes(x = sample_date, color = sample_id)) +
  geom_line(aes(y = ca_rolling)) +
  scale_color_brewer(palette = "Dark2") +
  labs(y = "Ca (mg/l)") +
  theme_classic() +
  geom_vline(xintercept = as.Date("1989-09-10"),
             linetype = "dotdash") +
  theme(axis.title.x = element_blank(),
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        legend.position = "none")

p5 <- ggplot(streams_long, aes(x = sample_date, color = sample_id)) +
  geom_line(aes(y = nh4_n_rolling)) +
  scale_color_brewer(palette = "Dark2") +
  labs(y = "NH4 (ug/l)",
       x = "Sample Date") +
  theme_classic() +
  geom_vline(xintercept = as.Date("1989-09-10"),
             linetype = "dotdash") +
  theme(legend.position = "none")
```

```{r, fig.width=8, fig.height=12}
#| warning: false
plots <- (p1 / p2 / p3 / p4 / p5)
plots + plot_annotation(
  title = "Chemistry of streams from the Luquillo Mountains",
  subtitle = "Post Hurricane Hugo (1989)",
  caption = "Data retrived from: McDowell, W. and International Institute of Tropical Forestry(IITF), USDA Forest Service.. 2024."
)
```
